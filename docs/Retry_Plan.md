実験を「固定タスク（暗記）」から「動的タスク（汎化）」へ修正し、スカラーDSLの局所最適（丸暗記）を打破するための具体的な修正案をまとめました。

これにより、Experiment 2B（手動注入後）においても、行列演算の劇的な優位性（フィットネスジャンプ）が観測されるようになります。

---

### **📝 実験設定の修正プラン**

#### **1\. タスク定義の変更 (Section 3.1 & 3.3)**

グラフのサイズ nodes とステップ数 k を固定値ではなく、**評価ごとに変動する確率変数**として再定義します。

* **変更前 (Fixed):**  
  * nodes \= 5  
  * k \= 3  
  * (常に同じグラフ形状、同じステップ数で評価)  
* **変更後 (Dynamic):**  
  * nodes \\sim \\text{Uniform}(3, 10\) （3〜10の範囲でランダム）  
  * k \\sim \\text{Uniform}(2, 6\) （2〜6の範囲でランダム）  
  * グラフの接続（隣接行列 A）も、各評価ごとにランダムに生成し直す。

#### **2\. 適応度（Fitness）評価関数の変更**

1つの個体（プログラム）の性能を測る際、たった1回のテストでは「運」の要素が強くなるため、**複数のテストケースに対する平均スコア**を使用します。

* **変更前:**  
  * 1つの固定グラフで実行し、正解なら高得点。  
* **変更後 (Meta-Fitness):**  
  * 各世代で、1個体につき **5〜10回** の異なる (N, k, A) の組み合わせでテストを実行。  
  * その **平均正答率** または **合計誤差** を適応度（Fitness）とする。  
  * これにより、「nodes=5 の時だけ正解する」ようなまぐれ当たりのコードは、平均点が下がり淘汰されます。

#### **3\. 期待される結果の変化 (Section 4.2.2 \- Exp 2B)**

この変更により、Experiment 2B（300世代目の注入実験）の結果は劇的に変わるはずです。

* **スカラーDSL:**  
  * nodes が変動するため、固定のループ回数や条件分岐で「暗記」したコードは通用しなくなります。  
  * 適応度は低〜中程度で停滞し、完全な正解には到達できません。  
* **行列DSL (注入後):**  
  * 行列演算（例: MATPOW(A, k)）は、nodes や k が何であっても数学的に正しい解を導き出せます。  
  * 注入された瞬間、スカラーDSLに対して\*\*圧倒的な適応度の差（Fitness Jump）\*\*を見せつけ、急速に集団を支配します。

---

### **📄 論文への反映案**

**Section 3.3 (Evolution Parameters) への追記:**

To prevent scalar DSLs from overfitting to a fixed graph size, we introduced **Dynamic Task Evaluation**. In each generation, the graph size nodes is chosen uniformly from \[3, 10\] and steps k from \[2, 6\]. Fitness is calculated as the success rate over 10 random instances per individual.

Section 5.4 (Limitations) の修正:

以前の「Future Workでやる」という記述を削除し、今回の修正実験の結果（「動的環境下では行列演算のみが生き残った」こと）を Results セクションに統合することで、論文の完成度がさらに高まります。

この設定であれば、局所最適の問題をクリアし、\*\*「普遍的な法則（行列）vs その場しのぎの解（スカラー）」\*\*という対比がより鮮明になります。

